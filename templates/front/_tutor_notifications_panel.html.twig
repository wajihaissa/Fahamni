{% set hasNotifs = statusNotifs|length > 0 or interactionNotifs|length > 0 %}

{% if not hasNotifs %}
    <div style="padding: 40px 16px; text-align: center; color: var(--text-light, #6b7280);">
        <i class="fas fa-bell-slash" style="font-size: 2.5rem; margin-bottom: 12px; opacity: 0.3;"></i>
        <p style="margin: 0; font-size: 0.95rem; font-weight: 500;">Aucune notification</p>
        <p style="margin: 4px 0 0; font-size: 0.8rem; opacity: 0.7;">Vous serez notifié des likes, commentaires et décisions sur vos articles</p>
    </div>
{% else %}
    <div style="padding: 8px 12px; border-bottom: 1px solid var(--border-color, #e5e7eb); display: flex; justify-content: flex-end;">
        <button type="button" id="tutorNotifMarkAllBtn" style="background: none; border: none; color: var(--primary-color, #6366f1); font-size: 0.8rem; font-weight: 600; cursor: pointer; padding: 4px 8px; border-radius: 6px; transition: background 0.2s;">
            Tout marquer comme lu
        </button>
    </div>

    {# --- Notifications de statut (acceptation / refus) --- #}
    {% if statusNotifs|length > 0 %}
        <div style="padding: 8px 16px 4px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-light, #9ca3af);">
            Décisions sur vos articles
        </div>
        {% for blog in statusNotifs %}
            {% set isUnread = not blog.statusNotifRead %}
            <a href="/articles" class="tutor-notif-item" data-type="status" data-id="{{ blog.id }}"
               style="display: flex; align-items: flex-start; gap: 10px; padding: 12px 16px; text-decoration: none; color: inherit; border-bottom: 1px solid var(--border-color, #e5e7eb); transition: background 0.2s; background: {{ isUnread ? 'rgba(99, 102, 241, 0.07)' : 'transparent' }};">
                <div style="width: 36px; height: 36px; border-radius: 50%; background: {{ blog.status == 'published' ? '#10b981' : '#ef4444' }}; color: #fff; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 0.85rem; opacity: {{ isUnread ? '1' : '0.5' }};">
                    <i class="fas {{ blog.status == 'published' ? 'fa-check' : 'fa-times' }}"></i>
                </div>
                <div style="flex: 1; min-width: 0;">
                    <p style="margin: 0; font-size: 0.85rem; color: {{ isUnread ? 'var(--text-color, #1f2937)' : 'var(--text-light, #6b7280)' }}; line-height: 1.4;">
                        Votre article "<strong>{{ blog.titre|length > 35 ? blog.titre[:35] ~ '...' : blog.titre }}</strong>"
                        {% if blog.status == 'published' %}
                            a été <span style="color: #10b981; font-weight: 700;">accepté et publié</span>
                        {% else %}
                            a été <span style="color: #ef4444; font-weight: 700;">rejeté</span>
                        {% endif %}
                    </p>
                    <span style="font-size: 0.75rem; color: var(--text-light, #9ca3af); margin-top: 2px; display: block;">
                        {{ blog.createdAt|date('d/m/Y H:i') }}
                    </span>
                </div>
                {% if isUnread %}
                    <span style="width: 8px; height: 8px; border-radius: 50%; background: #6366f1; flex-shrink: 0; margin-top: 4px;"></span>
                {% endif %}
            </a>
        {% endfor %}
    {% endif %}

    {# --- Notifications d'interactions (likes / commentaires) --- #}
    {% if interactionNotifs|length > 0 %}
        <div style="padding: 8px 16px 4px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-light, #9ca3af);">
            Interactions
        </div>
        {% for notif in interactionNotifs %}
            {% set isUnread = not notif.notifRead %}
            <a href="/articles" class="tutor-notif-item" data-type="interaction" data-id="{{ notif.id }}"
               style="display: flex; align-items: flex-start; gap: 10px; padding: 12px 16px; text-decoration: none; color: inherit; border-bottom: 1px solid var(--border-color, #e5e7eb); transition: background 0.2s; background: {{ isUnread ? 'rgba(99, 102, 241, 0.07)' : 'transparent' }};">
                <div style="width: 36px; height: 36px; border-radius: 50%; background: {{ notif.reaction ? '#f59e0b' : '#6366f1' }}; color: #fff; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 0.8rem; opacity: {{ isUnread ? '1' : '0.5' }};">
                    <i class="fas {{ notif.reaction ? 'fa-heart' : 'fa-comment' }}"></i>
                </div>
                <div style="flex: 1; min-width: 0;">
                    <p style="margin: 0; font-size: 0.85rem; color: {{ isUnread ? 'var(--text-color, #1f2937)' : 'var(--text-light, #6b7280)' }}; line-height: 1.4;">
                        <strong>{{ notif.innteractor.fullName ?: notif.innteractor.email|split('@')[0] }}</strong>
                        {% if notif.reaction %}
                            a aimé votre article
                        {% else %}
                            a commenté votre article
                        {% endif %}
                        "<strong>{{ notif.blog.titre|length > 30 ? notif.blog.titre[:30] ~ '...' : notif.blog.titre }}</strong>"
                    </p>
                    {% if notif.comment %}
                        <p style="margin: 4px 0 0; font-size: 0.8rem; color: var(--text-light, #9ca3af); font-style: italic; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            "{{ notif.comment|length > 50 ? notif.comment[:50] ~ '...' : notif.comment }}"
                        </p>
                    {% endif %}
                    <span style="font-size: 0.75rem; color: var(--text-light, #9ca3af); margin-top: 2px; display: block;">
                        {{ notif.createdAt|date('d/m/Y H:i') }}
                    </span>
                </div>
                {% if isUnread %}
                    <span style="width: 8px; height: 8px; border-radius: 50%; background: #6366f1; flex-shrink: 0; margin-top: 4px;"></span>
                {% endif %}
            </a>
        {% endfor %}
    {% endif %}
{% endif %}
