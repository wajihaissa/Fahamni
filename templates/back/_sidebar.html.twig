<aside class="sidebar">
    <div class="sidebar-header">
        <div class="logo">
            <h2>FAHIMNI</h2>
            <div class="brand-sub">Admin</div>
        </div>
    </div>

    <div class="admin-profile">
        <div style="display:flex;align-items:center;gap:10px">
            <div class="avatar">
                {%- set name = app.user.fullName|default(app.user.username|default('A')) -%}
                {%- set parts = name|split(' ') -%}
                <div style="width:44px;height:44px;border-radius:10px;background:var(--primary);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700">
                    {%- if parts|length >= 2 -%}{{ parts[0][0:1]|upper }}{{ parts[1][0:1]|upper }}{%- else -%}{{ name[0:1]|upper }}{%- endif -%}
                </div>
            </div>
            <div class="admin-info">
                <h4>{{ app.user.fullName|default(app.user.username|default('Admin')) }}</h4>
                <p>Administrator</p>
            </div>
        </div>
    </div>

    {% set current_route = app.request.get('_route') ?? '' %}
    <ul class="sidebar-nav">
        <li class="{% if current_route == 'admin_dashboard' %}active{% endif %}"><a href="{{ path('admin_dashboard') }}"><i class="fas fa-tachometer-alt"></i><span class="label">Dashboard</span></a></li>
        <li class="{% if current_route starts with 'admin_users_' %}active{% endif %}"><a href="{{ path('admin_users_index') }}"><i class="fas fa-users"></i><span class="label">Users</span></a></li>
        <li class="sidebar-dropdown {% if current_route starts with 'admin_messenger_' %}open{% endif %}">
            <a href="javascript:void(0)" class="sidebar-dropdown-toggle"><i class="fas fa-comments"></i><span class="label">Messagerie</span><i class="fas fa-chevron-down sidebar-dropdown-arrow"></i></a>
            <ul class="sidebar-subnav">
                <li class="{% if current_route == 'admin_messenger_index' %}active{% endif %}"><a href="{{ path('admin_messenger_index') }}"><i class="fas fa-chart-pie"></i><span class="label">Statistics</span></a></li>
                <li class="{% if current_route == 'admin_messenger_conversations' %}active{% endif %}"><a href="{{ path('admin_messenger_conversations') }}"><i class="fas fa-comments"></i><span class="label">Conversations</span></a></li>
                <li class="{% if current_route == 'admin_messenger_alerts' %}active{% endif %}"><a href="{{ path('admin_messenger_alerts') }}"><i class="fas fa-bell"></i><span class="label">Alertes</span></a></li>
            </ul>
        </li>
        <li class="{% if current_route == 'admin_articles' %}active{% endif %}"><a href="{{ path('admin_articles') }}"><i class="fas fa-newspaper"></i><span class="label">Articles</span></a></li>
        <li class="{% if current_route starts with 'admin_quiz_' %}active{% endif %}"><a href="{{ path('admin_quiz_list') }}"><i class="fas fa-question-circle"></i><span class="label">Quiz</span></a></li>
        <li class="{% if current_route == 'admin_statistics' %}active{% endif %}"><a href="{{ path('admin_statistics') }}"><i class="fas fa-chart-bar"></i><span class="label">Statistics</span></a></li>
        <li><a href="{{ path('app_home') }}"><i class="fas fa-home"></i><span class="label">User Space</span></a></li>
        <li><a href="{{ path('app_logout') }}"><i class="fas fa-sign-out-alt"></i><span class="label">Logout</span></a></li>
    </ul>
    <style>
        .sidebar-dropdown { position: relative; }
        .sidebar-dropdown .sidebar-dropdown-toggle { justify-content: space-between; }
        .sidebar-dropdown .sidebar-dropdown-arrow { font-size: 12px; transition: transform 0.2s ease; margin-left: auto; }
        .sidebar-dropdown.open .sidebar-dropdown-arrow { transform: rotate(180deg); }
        .sidebar-dropdown.open .sidebar-subnav { display: block; }
        .sidebar-dropdown.open .sidebar-dropdown-arrow { transform: rotate(180deg); }
        .sidebar-subnav { list-style: none; padding: 4px 0 4px 0; margin: 0; display: none; }
        .sidebar-subnav li { margin: 0; }
        .sidebar-subnav a { padding-left: 50px; font-size: 13px; color: rgba(255,255,255,0.75); }
        .sidebar-subnav a:hover { color: #fff; }
        .sidebar-subnav li.active a { background: rgba(255,255,255,0.04); color: #fff; font-weight: 600; }
    </style>
    <script>
        document.querySelectorAll('.sidebar-dropdown-toggle').forEach(function(btn) {
            btn.addEventListener('click', function(e) { e.preventDefault(); this.closest('.sidebar-dropdown').classList.toggle('open'); });
        });
        document.querySelectorAll('.sidebar-dropdown.open').forEach(function(li) { li.classList.add('open'); });
    </script>
</aside>
