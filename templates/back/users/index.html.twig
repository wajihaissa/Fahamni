{% extends 'base.html.twig' %}

{% block title %}Users Management - FAHIMNI Admin{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root{
            --bg:#f8fafc;
            --nav:#0b1220;
            --card:#ffffff;
            --muted:#6b7280;
            --text:#0b1220;
            --text-primary:#0b1220;
            --border:#e5e7eb;
            --primary:#6c5ce7;
            --primary-grad:linear-gradient(90deg,#7c6cff 0%,#6c5ce7 100%);
            --primary-gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            --radius:12px;
            --shadow:0 6px 18px rgba(11,18,32,0.06);
            --sidebar-width:280px;
        }

        body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;background:var(--bg);color:var(--muted)}

        /* Sidebar (identique dashboard / messagerie) */
        .sidebar{
            position:fixed;top:0;left:0;width:var(--sidebar-width);height:100vh;
            background:linear-gradient(180deg,#3b2f63 0%,#2b2350 100%);
            color:#fff;box-shadow:0 12px 40px rgba(19,24,44,0.25);z-index:1000;overflow-y:auto;
        }
        .sidebar-header{padding:1rem 0.5rem;border-bottom:1px solid rgba(255,255,255,0.04);margin-bottom:6px;}
        .sidebar .logo h2{color:#fff;font-size:18px;font-weight:700;margin:0 0 4px 8px;letter-spacing:0.3px;}
        .sidebar .logo .brand-sub{color:rgba(255,255,255,0.75);font-size:12px;margin-left:8px;}
        .admin-profile{padding:12px 8px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.04);}
        .admin-info h4{color:#fff;margin:0;font-size:14px;}
        .admin-info p{color:rgba(255,255,255,0.65);margin:2px 0 0 0;font-size:12px;}
        .sidebar-nav{list-style:none;padding:6px;margin:6px 0;}
        .sidebar-nav li{margin:6px 0;}
        .sidebar-nav a{display:flex;align-items:center;gap:12px;padding:10px 12px;color:rgba(255,255,255,0.86);text-decoration:none;border-radius:10px;position:relative;transition:background 0.18s ease,transform 0.12s ease;}
        .sidebar-nav a i{width:26px;text-align:center;font-size:14px;color:inherit;}
        .sidebar-nav a .label{font-size:14px;}
        .sidebar-nav a:hover{background:rgba(255,255,255,0.04);color:#fff;transform:translateX(3px);}
        .sidebar-nav li.active a{background:rgba(255,255,255,0.04);color:#fff;font-weight:600;}
        .main-content{margin-left:var(--sidebar-width);min-height:100vh;}

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .admin-header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .btn-primary{background:var(--primary-grad);color:#fff;border:none;padding:8px 14px;border-radius:12px;font-weight:600;display:inline-flex;align-items:center;gap:8px}

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;overflow:hidden;border:1px solid var(--border)}

        .table-container {
            overflow-x: auto;
            background: transparent;
            padding: 0;
            border-radius: 14px;
            margin-bottom: 18px;
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 12px;
            background: transparent;
        }

        .data-table th,
        .data-table td {
            text-align: left;
            padding: 14px 12px;
            vertical-align: middle;
        }

        .data-table thead th {
            background: transparent;
            font-weight: 700;
            color: var(--muted);
            font-size: 0.9rem;
            text-transform: none;
            padding: 12px 16px 16px 16px;
            border-bottom: none;
        }

        /* Each row is a card */
        .data-table tbody tr {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 8px 22px rgba(14,22,50,0.04);
            transition: all 0.18s ease;
            height: 70px;
            display: table-row;
        }

        .data-table tbody tr:hover {
            transform: translateY(-3px);
            box-shadow: 0 18px 50px rgba(14,22,50,0.08);
            border-color: #667eea;
        }

        .data-table tbody tr td {
            background: transparent;
            border: none;
            padding: 0 16px;
            vertical-align: middle;
            height: 100%;
            font-size: 0.95rem;
        }

        .data-table tbody tr td:first-child { border-top-left-radius: 10px; border-bottom-left-radius: 10px; }
        .data-table tbody tr td:last-child { border-top-right-radius: 10px; border-bottom-right-radius: 10px; }

        .user-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar{
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
        }

        .user-cell span {
            font-weight: 500;
            color: var(--text-primary);
        }

        .badge {
            display: inline-block;
            padding: 0.35rem 0.85rem;
            border-radius: 0.65rem;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            white-space: nowrap;
        }

        .badge-active {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            box-shadow: 0 4px 12px rgba(6, 95, 70, 0.12);
        }

        .badge-inactive {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            box-shadow: 0 4px 12px rgba(153, 27, 27, 0.12);
        }

        .badge-student {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.12);
        }

        .badge-tutor {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            box-shadow: 0 4px 12px rgba(6, 95, 70, 0.12);
        }

        .actions {
            display: flex;
            gap: 0.6rem;
            justify-content: flex-end;
            align-items: center;
        }

        .btn-action {
            width: 38px;
            height: 38px;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.18s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.95rem;
        }

        .btn-view {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.12);
        }

        .btn-edit {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            box-shadow: 0 4px 12px rgba(146, 64, 14, 0.12);
        }

        .btn-delete {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            box-shadow: 0 4px 12px rgba(153, 27, 27, 0.12);
        }

        .btn-action:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .alert{padding:12px;border-radius:10px;margin-bottom:12px}

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .empty{text-align:center;padding:28px;color:var(--muted)}
    </style>
{% endblock %}

{% block body %}
    {% include 'back/_sidebar.html.twig' %}
    <div class="main-content">
        {% include 'back/_admin_navbar.html.twig' %}
        <div class="admin-container">
        {% for type, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ type }}">
                    <i class="fas fa-{% if type == 'success' %}check-circle{% else %}exclamation-circle{% endif %}"></i>
                    {{ message }}
                </div>
            {% endfor %}
        {% endfor %}

        <div class="admin-header">
            <h1>Users Management</h1>
            <a href="{{ path('admin_users_create') }}" class="btn-primary">
                <i class="fas fa-plus"></i> Add New User
            </a>
        </div>

        <div class="card">
            {% if users|length > 0 %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                                <tr>
                                    <td>
                                        <div class="user-cell">
                                            <div class="user-avatar">
                                                {%- set parts = user.fullName|split(' ') -%}
                                                {%- if parts|length >= 2 -%}
                                                    {{ (parts[0][0:1])|upper }}{{ (parts[1][0:1])|upper }}
                                                {%- else -%}
                                                    {{ (user.fullName[0:1])|upper }}
                                                {%- endif -%}
                                            </div>
                                            <span>{{ user.fullName }}</span>
                                        </div>
                                    </td>
                                    <td>{{ user.email }}</td>
                                    <td>
                                        <span class="badge {% if 'ROLE_TUTOR' in user.roles %}badge-tutor{% else %}badge-student{% endif %}">
                                            {{ user.roles[0]|replace({'ROLE_': ''})|lower }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge {% if user.status %}badge-active{% else %}badge-inactive{% endif %}">
                                            {{ user.status ? 'Active' : 'Inactive' }}
                                        </span>
                                    </td>
                                    <td>{{ user.createdAt|date('M d, Y') }}</td>
                                    <td>
                                        <div class="actions">
                                            <button class="btn-action btn-view" title="View" onclick="event.preventDefault(); event.stopPropagation();">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn-action btn-edit" title="Edit" onclick="event.preventDefault();" data-user-id="{{ user.id }}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn-action btn-delete" title="Delete" onclick="event.preventDefault();" data-user-id="{{ user.id }}" data-delete-url="{{ path('admin_users_delete', {id: user.id}) }}" data-csrf="{{ csrf_token('delete' ~ user.id) }}">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty">
                    <i class="fas fa-users" style="font-size: 3rem; color: var(--border-color); display: block; margin-bottom: 1rem;"></i>
                    <p>No users found</p>
                </div>
            {% endif %}
        </div>
        </div>
    </div>
{% endblock %}
